<!DOCTYPE html>
<html style="display: none;" lang="zh">
    <head>
    <meta charset="utf-8">
    <!--
        © Material Theme
        https://github.com/viosey/hexo-theme-material
        Version: 1.5.2 -->
    <script>
        window.materialVersion = "1.5.2"
        // Delete localstorage with these tags
        window.oldVersion = [
            'codestartv1',
            '1.3.4',
            '1.4.0',
            '1.4.0b1',
            '1.5.0'
        ]
    </script>

    <!-- dns prefetch -->
    <meta http-equiv="x-dns-prefetch-control" content="on">


    <link rel="dns-prefetch" href="https://cdn1.lncld.net"/>



    <link rel="dns-prefetch" href="https://changyan.sohu.com"/>











    <!-- Meta & Info -->
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="renderer" content="webkit">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">

    <!-- Title -->
    
    <title>
        
            Laravel-辅助函数auth与JWT扩展详解 | 
        
        Arony&#39;s 技术博客
    </title>

    <!-- Favicons -->
    <link rel="icon shortcut" type="image/ico" href="/img/logo.png">
    <link rel="icon" href="/img/logo.png">

    <meta name="format-detection" content="telephone=no"/>
    <meta name="description" itemprop="description" content="遗世独立的理想乡">
    <meta name="keywords" content="skyArony，三翼,Laravel,JWT">
    <meta name="theme-color" content="#607d8b">

    <!-- Disable Fucking Bloody Baidu Tranformation -->
    <meta http-equiv="Cache-Control" content="no-transform" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />

    <!--[if lte IE 9]>
        <link rel="stylesheet" href="/css/ie-blocker.css">

        
            <script src="/js/ie-blocker.zhCN.js"></script>
        
    <![endif]-->

    <!-- Import lsloader -->
    <script>(function(){window.lsloader={jsRunSequence:[],jsnamemap:{},cssnamemap:{}};lsloader.removeLS=function(a){try{localStorage.removeItem(a)}catch(b){}};lsloader.setLS=function(a,c){try{localStorage.setItem(a,c)}catch(b){}};lsloader.getLS=function(a){var c="";try{c=localStorage.getItem(a)}catch(b){c=""}return c};versionString="/*"+(window.materialVersion||"unknownVersion")+"*/";lsloader.clean=function(){try{var b=[];for(var a=0;a<localStorage.length;a++){b.push(localStorage.key(a))}b.forEach(function(e){var f=lsloader.getLS(e);if(window.oldVersion){var d=window.oldVersion.reduce(function(g,h){return g||f.indexOf("/*"+h+"*/")!==-1},false);if(d){lsloader.removeLS(e)}}})}catch(c){}};lsloader.clean();lsloader.load=function(f,a,b,d){if(typeof b==="boolean"){d=b;b=undefined}d=d||false;b=b||function(){};var e;e=this.getLS(f);if(e&&e.indexOf(versionString)===-1){this.removeLS(f);this.requestResource(f,a,b,d);return}if(e){var c=e.split(versionString)[0];if(c!=a){console.log("reload:"+a);this.removeLS(f);this.requestResource(f,a,b,d);return}e=e.split(versionString)[1];if(d){this.jsRunSequence.push({name:f,code:e});this.runjs(a,f,e)}else{document.getElementById(f).appendChild(document.createTextNode(e));b()}}else{this.requestResource(f,a,b,d)}};lsloader.requestResource=function(b,e,a,c){var d=this;if(c){this.iojs(e,b,function(h,f,g){d.setLS(f,h+versionString+g);d.runjs(h,f,g)})}else{this.iocss(e,b,function(f){document.getElementById(b).appendChild(document.createTextNode(f));d.setLS(b,e+versionString+f)},a)}};lsloader.iojs=function(d,b,g){var a=this;a.jsRunSequence.push({name:b,code:""});try{var f=new XMLHttpRequest();f.open("get",d,true);f.onreadystatechange=function(){if(f.readyState==4){if((f.status>=200&&f.status<300)||f.status==304){if(f.response!=""){g(d,b,f.response);return}}a.jsfallback(d,b)}};f.send(null)}catch(c){a.jsfallback(d,b)}};lsloader.iocss=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.iofonts=function(f,c,h,a){var b=this;try{var g=new XMLHttpRequest();g.open("get",f,true);g.onreadystatechange=function(){if(g.readyState==4){if((g.status>=200&&g.status<300)||g.status==304){if(g.response!=""){h(g.response);a();return}}b.cssfallback(f,c,a)}};g.send(null)}catch(d){b.cssfallback(f,c,a)}};lsloader.runjs=function(f,c,e){if(!!c&&!!e){for(var b in this.jsRunSequence){if(this.jsRunSequence[b].name==c){this.jsRunSequence[b].code=e}}}if(!!this.jsRunSequence[0]&&!!this.jsRunSequence[0].code&&this.jsRunSequence[0].status!="failed"){var a=document.createElement("script");a.appendChild(document.createTextNode(this.jsRunSequence[0].code));a.type="text/javascript";document.getElementsByTagName("head")[0].appendChild(a);this.jsRunSequence.shift();if(this.jsRunSequence.length>0){this.runjs()}}else{if(!!this.jsRunSequence[0]&&this.jsRunSequence[0].status=="failed"){var d=this;var a=document.createElement("script");a.src=this.jsRunSequence[0].path;a.type="text/javascript";this.jsRunSequence[0].status="loading";a.onload=function(){d.jsRunSequence.shift();if(d.jsRunSequence.length>0){d.runjs()}};document.body.appendChild(a)}}};lsloader.tagLoad=function(b,a){this.jsRunSequence.push({name:a,code:"",path:b,status:"failed"});this.runjs()};lsloader.jsfallback=function(c,b){if(!!this.jsnamemap[b]){return}else{this.jsnamemap[b]=b}for(var a in this.jsRunSequence){if(this.jsRunSequence[a].name==b){this.jsRunSequence[a].code="";this.jsRunSequence[a].status="failed";this.jsRunSequence[a].path=c}}this.runjs()};lsloader.cssfallback=function(e,c,b){if(!!this.cssnamemap[c]){return}else{this.cssnamemap[c]=1}var d=document.createElement("link");d.type="text/css";d.href=e;d.rel="stylesheet";d.onload=d.onerror=b;var a=document.getElementsByTagName("script")[0];a.parentNode.insertBefore(d,a)};lsloader.runInlineScript=function(c,b){var a=document.getElementById(b).innerText;this.jsRunSequence.push({name:c,code:a});this.runjs()}})();</script>

    <!-- Import queue -->
    <script>function Queue(){this.dataStore=[];this.offer=b;this.poll=d;this.execNext=a;this.debug=false;this.startDebug=c;function b(e){if(this.debug){console.log("Offered a Queued Function.")}if(typeof e==="function"){this.dataStore.push(e)}else{console.log("You must offer a function.")}}function d(){if(this.debug){console.log("Polled a Queued Function.")}return this.dataStore.shift()}function a(){var e=this.poll();if(e!==undefined){if(this.debug){console.log("Run a Queued Function.")}e()}}function c(){this.debug=true}}var queue=new Queue();</script>

    <!-- Import CSS -->
    
        <style id="material_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_css","/css/material.min.css?Z7a72R1E4SxzBKR/WGctOA==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
        <style id="style_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("style_css","/css/style.min.css?MKetZV3cUTfDxvMffaOezg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>

        
            
                <style id="prettify_css"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_css","/css/prettify.min.css?zp8STOU9v89XWFEnN+6YmQ==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
                <style id="prettify_theme"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("prettify_theme","/css/prettify/tranquil-heart.min.css?ul3p9I9MsbOxK0L+BHzDDg==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>
            
        

    

    

    <!-- Config CSS -->

<!-- Other Styles -->
<style>
  body, html {
    font-family: Roboto, "Helvetica Neue", Helvetica, "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", "微软雅黑", Arial, sans-serif;
    overflow-x: hidden !important;
  }
  
  code {
    font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
  }

  a {
    color: #2780e3;
  }

  .mdl-card__media,
  #search-label,
  #search-form-label:after,
  #scheme-Paradox .hot_tags-count,
  #scheme-Paradox .sidebar_archives-count,
  #scheme-Paradox .sidebar-colored .sidebar-header,
  #scheme-Paradox .sidebar-colored .sidebar-badge{
    background-color: #607d8b !important;
  }

  /* Sidebar User Drop Down Menu Text Color */
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:hover,
  #scheme-Paradox .sidebar-colored .sidebar-nav>.dropdown>.dropdown-menu>li>a:focus {
    color: #607d8b !important;
  }

  #post_entry-right-info,
  .sidebar-colored .sidebar-nav li:hover > a,
  .sidebar-colored .sidebar-nav li:hover > a i,
  .sidebar-colored .sidebar-nav li > a:hover,
  .sidebar-colored .sidebar-nav li > a:hover i,
  .sidebar-colored .sidebar-nav li > a:focus i,
  .sidebar-colored .sidebar-nav > .open > a,
  .sidebar-colored .sidebar-nav > .open > a:hover,
  .sidebar-colored .sidebar-nav > .open > a:focus,
  #ds-reset #ds-ctx .ds-ctx-entry .ds-ctx-head a {
    color: #607d8b !important;
  }

  .toTop {
    background: #607d8b !important;
  }

  .material-layout .material-post>.material-nav,
  .material-layout .material-index>.material-nav,
  .material-nav a {
    color: #607d8b;
  }

  #scheme-Paradox .MD-burger-layer {
    background-color: #607d8b;
  }

  #scheme-Paradox #post-toc-trigger-btn {
    color: #607d8b;
  }

  .post-toc a:hover {
    color: #2780e3;
    text-decoration: underline;
  }

</style>


<!-- Theme Background Related-->

    <style>
      body{
        background-image: url(/img/bg2018.png);
      }
    </style>




<!-- Fade Effect -->


<!-- Import Font -->
<!-- Import Roboto -->

    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">


<!-- Import Material Icons -->


    <style id="material_icons"></style><script>if(typeof window.lsLoadCSSMaxNums === "undefined")window.lsLoadCSSMaxNums = 0;window.lsLoadCSSMaxNums++;lsloader.load("material_icons","/css/material-icons.css?pqhB/Rd/ab0H2+kZp0RDmw==",function(){if(typeof window.lsLoadCSSNums === "undefined")window.lsLoadCSSNums = 0;window.lsLoadCSSNums++;if(window.lsLoadCSSNums == window.lsLoadCSSMaxNums)document.documentElement.style.display="";}, false)</script>




    <!-- Import jQuery -->
    
        <script>lsloader.load("jq_js","/js/jquery.min.js?qcusAULNeBksqffqUM2+Ig==", true)</script>
    

    <!-- WebAPP Icons -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="application-name" content="Arony&#39;s 技术博客">
    <meta name="msapplication-starturl" content="http://blog.yfree.cc/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/">
    <meta name="msapplication-navbutton-color" content="#607d8b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Arony&#39;s 技术博客">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="/img/logo.png">

    <!-- Site Verification -->
    
    

    <!-- RSS -->
    

    <!-- The Open Graph protocol -->
    <meta property="og:url" content="http://blog.yfree.cc/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="Laravel-辅助函数auth与JWT扩展详解 | Arony&#39;s 技术博客">
    <meta property="og:image" content="/img/logo.png">
    <meta property="og:description" content="遗世独立的理想乡">
    <meta property="og:article:tag" content="Laravel"> <meta property="og:article:tag" content="JWT"> 

    
        <meta property="article:published_time" content="Tue May 08 2018 00:07:39 GMT+0800">
        <meta property="article:modified_time" content="Thu May 10 2018 18:04:06 GMT+0800">
    

    <!-- The Twitter Card protocol -->
    <meta name="twitter:card" content="summary_large_image">

    <!-- Add canonical link for SEO -->
    
        <link rel="canonical" href="http://blog.yfree.cc/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/index.html" />
    

    <!-- Structured-data for SEO -->
    
        


<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "BlogPosting",
    "mainEntityOfPage": "http://blog.yfree.cc/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/index.html",
    "headline": "Laravel-辅助函数auth与JWT扩展详解",
    "datePublished": "Tue May 08 2018 00:07:39 GMT+0800",
    "dateModified": "Thu May 10 2018 18:04:06 GMT+0800",
    "author": {
        "@type": "Person",
        "name": "Arony",
        "image": {
            "@type": "ImageObject",
            "url": "https://ooo.0o0.ooo/2017/06/19/5947a26ed9af5.jpg"
        },
        "description": "遗世独立的理想乡"
    },
    "publisher": {
        "@type": "Organization",
        "name": "Arony&#39;s 技术博客",
        "logo": {
            "@type":"ImageObject",
            "url": "/img/logo.png"
        }
    },
    "keywords": ",Laravel,JWTskyArony，三翼",
    "description": "遗世独立的理想乡",
}
</script>


    

    <!-- Analytics -->
    
    
    
        <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1273154911&web_id=1273154911" language="JavaScript"></script>
</div>
    

    <!-- Custom Head -->
    
        
            <style>code{font-family: consolas, Menlo, 'PingFang SC', 'Microsoft YaHei', monospace;color:#c33;margin: 0 2px;padding: 0 5px;background-color: rgba(0,0,0,.04);border-radius: 3px;}</style>
        
    

</head>


    
        <body id="scheme-Paradox" class="lazy">
            <div class="material-layout  mdl-js-layout has-drawer is-upgraded">
                

                <!-- Main Container -->
                <main class="material-layout__content" id="main">

                    <!-- Top Anchor -->
                    <div id="top"></div>

                    
                        <!-- Hamburger Button -->
                        <button class="MD-burger-icon sidebar-toggle">
                            <span class="MD-burger-layer"></span>
                        </button>
                    

                    <!-- Post TOC -->

    
    <!-- Back Button -->
    <!--
    <div class="material-back" id="backhome-div" tabindex="0">
        <a class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon"
           href="#" onclick="window.history.back();return false;"
           target="_self"
           role="button"
           data-upgraded=",MaterialButton,MaterialRipple">
            <i class="material-icons" role="presentation">arrow_back</i>
            <span class="mdl-button__ripple-container">
                <span class="mdl-ripple"></span>
            </span>
        </a>
    </div>
    -->


    <!-- Left aligned menu below button -->
    
    
    <button id="post-toc-trigger-btn"
        class="mdl-button mdl-js-button mdl-button--icon">
        <i class="material-icons">format_list_numbered</i>
    </button>

    <ul class="post-toc-wrap mdl-menu mdl-menu--bottom-left mdl-js-menu mdl-js-ripple-effect" for="post-toc-trigger-btn" style="max-height:80vh; overflow-y:scroll;">
        <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#参考资料"><span class="post-toc-text">参考资料</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#一、看守器"><span class="post-toc-text">一、看守器</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-契约"><span class="post-toc-text">1. 契约</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Illuminate-Contracts-Auth-Guard"><span class="post-toc-text">Illuminate\Contracts\Auth\Guard</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Illuminate-Contracts-Auth-StatefulGuard"><span class="post-toc-text">Illuminate\Contracts\Auth\StatefulGuard</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-对契约的实现"><span class="post-toc-text">2. 对契约的实现</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Illuminate-Auth-RequestGuard"><span class="post-toc-text">Illuminate\Auth\RequestGuard</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Illuminate-Auth-SessionGuard"><span class="post-toc-text">Illuminate\Auth\SessionGuard</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Illuminate-Auth-TokenGuard"><span class="post-toc-text">Illuminate\Auth\TokenGuard</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#Tymon-JWTAuth-JWTGuard"><span class="post-toc-text">Tymon\JWTAuth\JWTGuard</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-Gurad-的使用"><span class="post-toc-text">3. Gurad 的使用</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#二、中间件"><span class="post-toc-text">二、中间件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-定义"><span class="post-toc-text">1. 定义</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-1-app-Http-Kernel-php"><span class="post-toc-text">1.1 app\Http\Kernel.php</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auth-api"><span class="post-toc-text">auth:api</span></a></li></ol></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1-2-tymon-jwt-auth-src-Providers-AbstractServiceProvider-php"><span class="post-toc-text">1.2 tymon\jwt-auth\src\Providers\AbstractServiceProvider.php</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#jwt-auth"><span class="post-toc-text">jwt.auth</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#jwt-refresh"><span class="post-toc-text">jwt.refresh</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-使用"><span class="post-toc-text">2. 使用</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#3-区别"><span class="post-toc-text">3. 区别</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-1-jwt-refresh-和-jwt-auth"><span class="post-toc-text">3.1 jwt.refresh  和 jwt.auth</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3-2-jwt-auth-和-auth-api（auth）"><span class="post-toc-text">3.2 jwt.auth 和 auth:api（auth）</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auth-api（auth）"><span class="post-toc-text">auth:api（auth）</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#jwt-auth-1"><span class="post-toc-text">jwt.auth</span></a></li></ol></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#三、辅助函数和-Facade"><span class="post-toc-text">三、辅助函数和 Facade</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#1-辅助函数"><span class="post-toc-text">1. 辅助函数</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#auth"><span class="post-toc-text">auth()</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#JWT-下的-auth"><span class="post-toc-text">JWT 下的 auth()</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auth-gt-factory"><span class="post-toc-text">auth()-&gt;factory()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auth-gt-blacklist"><span class="post-toc-text">auth()-&gt;blacklist()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auth-gt-manager"><span class="post-toc-text">auth()-&gt;manager()</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#auth-gt-payload"><span class="post-toc-text">auth()-&gt;payload()</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#2-Facade"><span class="post-toc-text">2. Facade</span></a></li></ol></li></ol>
    </ul>
    




<!-- Layouts -->

    <!-- Post Module -->
    <div class="material-post_container">

        <div class="material-post mdl-grid">
            <div class="mdl-card mdl-shadow--4dp mdl-cell mdl-cell--12-col">

                <!-- Post Header(Thumbnail & Title) -->
                
    <!-- Paradox Post Header -->
    
        
            <!-- Pure Thumbnail -->
            <div class="post_thumbnail-pure mdl-card__media mdl-color-text--grey-50" style="background-color:#222 !important">
        
    
            <p class="article-headline-p">
                Laravel-辅助函数auth与JWT扩展详解
            </p>
        </div>





                
                    <!-- Paradox Post Info -->
                    <div class="mdl-color-text--grey-700 mdl-card__supporting-text meta">

    <!-- Author Avatar -->
    <div id="author-avatar">
        <img src="https://ooo.0o0.ooo/2017/06/19/5947a26ed9af5.jpg" width="44px" height="44px" alt="Author Avatar"/>
    </div>
    <!-- Author Name & Date -->
    <div>
        <strong>Arony</strong>
        <span>5月 08, 2018</span>
    </div>

    <div class="section-spacer"></div>

    <!-- Favorite -->
    <!--
        <button id="article-functions-like-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon btn-like">
            <i class="material-icons" role="presentation">favorite</i>
            <span class="visuallyhidden">favorites</span>
        </button>
    -->

    <!-- Qrcode -->
    

    <!-- Tags (bookmark) -->
    
    <button id="article-functions-viewtags-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
        <i class="material-icons" role="presentation">bookmark</i>
        <span class="visuallyhidden">bookmark</span>
    </button>
    <ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-functions-viewtags-button">
        <li class="mdl-menu__item">
        <a class="post_tag-link" href="/tags/JWT/">JWT</a></li><li class="mdl-menu__item"><a class="post_tag-link" href="/tags/Laravel/">Laravel</a>
    </ul>
    

    <!-- Share -->
    
        <button id="article-fuctions-share-button" class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon">
    <i class="material-icons" role="presentation">share</i>
    <span class="visuallyhidden">share</span>
</button>
<ul class="mdl-menu mdl-menu--bottom-right mdl-js-menu mdl-js-ripple-effect" for="article-fuctions-share-button">
    
    <!-- Leancloud Views -->
        <a class="post_share-link" href="#">
            <li class="mdl-menu__item">
                <span id="/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/" class="leancloud-views_num" data-flag-title="Laravel-辅助函数auth与JWT扩展详解">
     &nbsp;浏览量
</span>

            </li>
        </a>
    

    

    <!-- Share Weibo -->
    
        <a class="post_share-link" href="http://service.weibo.com/share/share.php?appkey=&title=Laravel-辅助函数auth与JWT扩展详解&url=http://blog.yfree.cc/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/index.html&pic=http://blog.yfree.cc/img/logo.png&searchPic=false&style=simple" target="_blank">
            <li class="mdl-menu__item">
                分享到微博
            </li>
        </a>
    

    <!-- Share Twitter -->
    

    <!-- Share Facebook -->
    
        <a class="post_share-link" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.yfree.cc/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 Facebook
            </li>
        </a>
    

    <!-- Share Google+ -->
    

    <!-- Share LinkedIn -->
    

    <!-- Share QQ -->
    
        <a class="post_share-link" href="http://connect.qq.com/widget/shareqq/index.html?site=Arony&#39;s 技术博客&title=Laravel-辅助函数auth与JWT扩展详解&summary=遗世独立的理想乡&pics=http://blog.yfree.cc/img/logo.png&url=http://blog.yfree.cc/2018/05/08/Laravel-辅助函数auth与JWT扩展详解/index.html" target="_blank">
            <li class="mdl-menu__item">
                分享到 QQ
            </li>
        </a>
    

    <!-- Share Telegram -->
    
</ul>

    
</div>

                

                <!-- Post Content -->
                <div id="post-content" class="mdl-color-text--grey-700 mdl-card__supporting-text fade out">
    
        <p><code>tymon/jwt-auth</code> 扩展是 Laravel 下能够很方便的实现 JWT token 的一个扩展，使用和配置都很简单，但是网上的文档新版本的、旧版本的掺杂在一起，看起来十分混乱，因此我仔细比对源码整理了一个比较完整的安装文档：<a href="/2018/01/11/Laravel-Lumen%E6%95%99%E7%A8%8B4-JWT%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">Laravel/Lumen教程4-JWT的基本使用</a> 。</p>
<p>看源码的过程中对这个扩展和 Laravel 的一些实现也有了比较深入的理解，记录如下。</p>
<blockquote>
<p>本文是以 1.0.0-rc 版为基准的。</p>
</blockquote>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><ul>
<li><a href="https://laravel-china.org/articles/3825/laravel-authentication-principle-and-full-custom-authentication" target="_blank" rel="noopener">Laravel 认证原理及完全自定义认证</a></li>
</ul>
<blockquote>
<p>Tips：最好打开框架和扩展中的源代码放一边参考，这样更利于理解，每个文件的路径和命名空间基本一致。</p>
</blockquote>
<h1 id="一、看守器"><a href="#一、看守器" class="headerlink" title="一、看守器"></a>一、看守器</h1><h2 id="1-契约"><a href="#1-契约" class="headerlink" title="1. 契约"></a>1. 契约</h2><p>看守器 Guard 是一组契约（不懂的话就看成接口吧），定义了一些认证和登录的常用方法。</p>
<h3 id="Illuminate-Contracts-Auth-Guard"><a href="#Illuminate-Contracts-Auth-Guard" class="headerlink" title="Illuminate\Contracts\Auth\Guard"></a>Illuminate\Contracts\Auth\Guard</h3><p>这个看守器定契约义了如下方法，而 JWT 的看守器便是实现了这个接口，所以 JWT 的看守器就会具有这些方法，当然 JWT 的看守器还并不止这些方法，这个后面再仔细说。</p>
<pre><code class="php">// 判断当前用户是否登录
public function check();
// 判断当前用户是否是游客（未登录）
public function guest();
// 获取当前认证的用户
public function user();
// 获取当前认证用户的 id，严格来说不一定是 id，应该是上个模型中定义的唯一的字段名
public function id();
// 根据提供的消息认证用户
public function validate(array $credentials = []);
// 设置当前用户
public function setUser(Authenticatable $user);
</code></pre>
<h3 id="Illuminate-Contracts-Auth-StatefulGuard"><a href="#Illuminate-Contracts-Auth-StatefulGuard" class="headerlink" title="Illuminate\Contracts\Auth\StatefulGuard"></a>Illuminate\Contracts\Auth\StatefulGuard</h3><p>StatefulGuard 接口继承自 Guard 接口，并添加了一些新的有状态的方法。</p>
<p>看到 attempt 方法，可能有人就会觉得 JWT 的看守器似乎好像有理由是由这个继承而来，然后代码告诉我们，并非如此。</p>
<pre><code class="php">// 尝试根据提供的凭证验证用户是否合法
public function attempt(array $credentials = [], $remember = false);
// 一次性登录，不记录session or cookie
public function once(array $credentials = []);
// 登录用户，通常在验证成功后记录 session 和 cookie 
public function login(Authenticatable $user, $remember = false);
// 使用用户 id 登录
public function loginUsingId($id, $remember = false);
// 使用用户 ID 登录，但是不记录 session 和 cookie
public function onceUsingId($id);
// 通过 cookie 中的 remember token 自动登录
public function viaRemember();
// 登出
public function logout();
</code></pre>
<h2 id="2-对契约的实现"><a href="#2-对契约的实现" class="headerlink" title="2. 对契约的实现"></a>2. 对契约的实现</h2><p>有了契约之后就要实现契约了，Laravel 框架自己针对上述契约实现了三个看守器类。</p>
<h3 id="Illuminate-Auth-RequestGuard"><a href="#Illuminate-Auth-RequestGuard" class="headerlink" title="Illuminate\Auth\RequestGuard"></a>Illuminate\Auth\RequestGuard</h3><p>实现了 Guard ，这里面的方法非常简单，大概就契约里约定的那么多，而且有一部分复用 GuardHelpers 这个 trait 来实现的。</p>
<h3 id="Illuminate-Auth-SessionGuard"><a href="#Illuminate-Auth-SessionGuard" class="headerlink" title="Illuminate\Auth\SessionGuard"></a>Illuminate\Auth\SessionGuard</h3><p>实现了 StatefulGuard，是 Laravel web 认证默认的 guard，定义了完整的 session 方式登录实现。</p>
<h3 id="Illuminate-Auth-TokenGuard"><a href="#Illuminate-Auth-TokenGuard" class="headerlink" title="Illuminate\Auth\TokenGuard"></a>Illuminate\Auth\TokenGuard</h3><p>实现了 Guard，适用于无状态 api 认证，通过 token 认证。但这里面实现的方法也挺少的，你可以根据这个实现一个简单的 token 认证。</p>
<hr>
<h3 id="Tymon-JWTAuth-JWTGuard"><a href="#Tymon-JWTAuth-JWTGuard" class="headerlink" title="Tymon\JWTAuth\JWTGuard"></a>Tymon\JWTAuth\JWTGuard</h3><p>然后主角登场了，JWTGuard 实现了 Guard，和上面的三个实现是同级的，你可以理解为，官方的 TokenGuard 功能太简单，这个扩展写了一个比 TokenGuard 功能更加丰富的 Guard。</p>
<h2 id="3-Gurad-的使用"><a href="#3-Gurad-的使用" class="headerlink" title="3. Gurad 的使用"></a>3. Gurad 的使用</h2><p>好，我们现在已经知道 Guard 是什么一个东西已经它的实现了，那怎么使用呢？打开下面文件：</p>
<p><strong>/config/auth.php</strong></p>
<pre><code class="php">// 这里是指定默认的看守器
// web 的意思取下面 guards 数组 key 为 web 的那个
// passwords 是重置密码相关，暂时不懂什么意思
&#39;defaults&#39; =&gt; [
    &#39;guard&#39; =&gt; &#39;web&#39;,
    &#39;passwords&#39; =&gt; &#39;users&#39;,
],

// 这里定义可以用的 guard
// driver 指的就是上面的对 Guard 契约的具体实现那个类了
// users 是下面 providers 数组 key 为 users 的那个
&#39;guards&#39; =&gt; [
    &#39;web&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;session&#39;,    // SessionGuard 实现
        &#39;provider&#39; =&gt; &#39;users&#39;,    
    ],

    &#39;api&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;jwt&#39;,  // JWTGuard 实现，源码中为 token，我这改成 jwt 了
        &#39;provider&#39; =&gt; &#39;users&#39;,
    ],
],

// 这个的作用是指定认证所需的 user 来源的数据表
&#39;providers&#39; =&gt; [
    &#39;users&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;eloquent&#39;,
        &#39;model&#39; =&gt; App\User::class,
    ],

    // &#39;users&#39; =&gt; [
    //     &#39;driver&#39; =&gt; &#39;database&#39;,
    //     &#39;table&#39; =&gt; &#39;users&#39;,
    // ],
],
</code></pre>
<blockquote>
<p>通过以上你就知道了：</p>
<ol>
<li>认证用的那些方法是通过实现了 Guard 契约，契约保证了框架与扩展之间的低耦合性，为什么这样可以低耦合，后面中间件和辅助函数会具体介绍</li>
<li>JWT 的 JWTGuard 实现了 Guard 契约</li>
<li>定义的 Guard 如何具体使用</li>
</ol>
</blockquote>
<h1 id="二、中间件"><a href="#二、中间件" class="headerlink" title="二、中间件"></a>二、中间件</h1><p>看 JWT 的文档，里面定义的 AuthController 方法使用的是 <code>auth:api</code> 中间件，而 JWT 还提供了 <code>jwt.auth</code> 和 <code>jwt.refresh</code> 中间件，那么这些中间件有什么不同又是如何起作用的呢？</p>
<h2 id="1-定义"><a href="#1-定义" class="headerlink" title="1. 定义"></a>1. 定义</h2><h3 id="1-1-app-Http-Kernel-php"><a href="#1-1-app-Http-Kernel-php" class="headerlink" title="1.1 app\Http\Kernel.php"></a>1.1 app\Http\Kernel.php</h3><p>这个文件中定义了框架自带的中间件：</p>
<pre><code class="php">protected $routeMiddleware = [
        &#39;auth&#39; =&gt; \Illuminate\Auth\Middleware\Authenticate::class,
        &#39;auth.basic&#39; =&gt; \Illuminate\Auth\Middleware\AuthenticateWithBasicAuth::class,
        &#39;bindings&#39; =&gt; \Illuminate\Routing\Middleware\SubstituteBindings::class,
        &#39;cache.headers&#39; =&gt; \Illuminate\Http\Middleware\SetCacheHeaders::class,
        &#39;can&#39; =&gt; \Illuminate\Auth\Middleware\Authorize::class,
        &#39;guest&#39; =&gt; \App\Http\Middleware\RedirectIfAuthenticated::class,
        &#39;signed&#39; =&gt; \Illuminate\Routing\Middleware\ValidateSignature::class,
        &#39;throttle&#39; =&gt; \Illuminate\Routing\Middleware\ThrottleRequests::class,
];
</code></pre>
<h4 id="auth-api"><a href="#auth-api" class="headerlink" title="auth:api"></a>auth:api</h4><p>可以发现 <code>auth:api</code> 使用的就是第一个中间件，而后面 <code>:api</code> 是路由参数，指定了要使用哪个看守器，可以看到下面 <code>api</code> 对应的看守器就是 <code>jwt</code> 的看守器。</p>
<p>并且你可以直接使用 <code>auth</code> ，这样就相当于使用 defaults 中指定的看守器，即 session。</p>
<blockquote>
<p>Lumen 默认用的就是 api 那个，所以你直接用 auth 作为 api 路由的中间件完全没问题</p>
<p>Laravel 中指定了两个看守器，而且默认的并不是 api，所以你必须得用 auth:api 作为路由的中间件</p>
</blockquote>
<p>功能是检查 token 的有效性，决定是否放行。</p>
<p><strong>/config/auth.php</strong></p>
<pre><code class="php">&#39;defaults&#39; =&gt; [
    &#39;guard&#39; =&gt; &#39;web&#39;,
    &#39;passwords&#39; =&gt; &#39;users&#39;,
],

&#39;guards&#39; =&gt; [
    &#39;web&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;session&#39;,    // SessionGuard 实现
        &#39;provider&#39; =&gt; &#39;users&#39;,    
    ],

    &#39;api&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;jwt&#39;,  // JWTGuard 实现，源码中为 token，我这改成 jwt 了
        &#39;provider&#39; =&gt; &#39;users&#39;,
    ],
]
</code></pre>
<h3 id="1-2-tymon-jwt-auth-src-Providers-AbstractServiceProvider-php"><a href="#1-2-tymon-jwt-auth-src-Providers-AbstractServiceProvider-php" class="headerlink" title="1.2 tymon\jwt-auth\src\Providers\AbstractServiceProvider.php"></a>1.2 tymon\jwt-auth\src\Providers\AbstractServiceProvider.php</h3><pre><code class="php">protected $middlewareAliases = [
    &#39;jwt.auth&#39; =&gt; Authenticate::class,
    &#39;jwt.check&#39; =&gt; Check::class,
    &#39;jwt.refresh&#39; =&gt; RefreshToken::class,
    &#39;jwt.renew&#39; =&gt; AuthenticateAndRenew::class,
];
</code></pre>
<p>这个文件中定义了 jwt-auth 插件的中间件，第一二个功能一样，只是第二个不会主动抛出错误，第三四个功能一样。</p>
<h4 id="jwt-auth"><a href="#jwt-auth" class="headerlink" title="jwt.auth"></a>jwt.auth</h4><p>这个和上面的功能完全一致，至于有什么区别后面会具体解释。</p>
<h4 id="jwt-refresh"><a href="#jwt-refresh" class="headerlink" title="jwt.refresh"></a>jwt.refresh</h4><p>这个出来检验 token 的有效性并决定如何放行外，还会在返回的 header 头上加入新的 token，达到每次请求都换取新 token 的效果。</p>
<h2 id="2-使用"><a href="#2-使用" class="headerlink" title="2. 使用"></a>2. 使用</h2><p>使用就不多说了，官方文档介绍的很详细了。</p>
<pre><code class="php">$this-&gt;middleware(&#39;auth:api&#39;, [&#39;except&#39; =&gt; [&#39;login&#39;]]);
</code></pre>
<h2 id="3-区别"><a href="#3-区别" class="headerlink" title="3. 区别"></a>3. 区别</h2><p>接下来就探讨一下，这三个中间件有什么区别。</p>
<h3 id="3-1-jwt-refresh-和-jwt-auth"><a href="#3-1-jwt-refresh-和-jwt-auth" class="headerlink" title="3.1 jwt.refresh  和 jwt.auth"></a>3.1 jwt.refresh  和 jwt.auth</h3><p>这个的区别就是前者会在响应的 header 头中增加刷新的新 token。</p>
<h3 id="3-2-jwt-auth-和-auth-api（auth）"><a href="#3-2-jwt-auth-和-auth-api（auth）" class="headerlink" title="3.2 jwt.auth 和 auth:api（auth）"></a>3.2 jwt.auth 和 auth:api（auth）</h3><p>这两个功能完全一致，只是调用链有所差别，而这个差别正好可以体现上面提到的低耦合性。</p>
<h4 id="auth-api（auth）"><a href="#auth-api（auth）" class="headerlink" title="auth:api（auth）"></a>auth:api（auth）</h4><p><strong>Illuminate\Auth\Middleware\Authenticate</strong></p>
<pre><code class="php">use Illuminate\Contracts\Auth\Factory as Auth;

public function __construct(Auth $auth)
{
    $this-&gt;auth = $auth;
}

public function handle($request, Closure $next, ...$guards)
{
    $this-&gt;authenticate($guards);

    return $next($request);
}

protected function authenticate(array $guards)
{
    if (empty($guards)) {
        return $this-&gt;auth-&gt;authenticate();
    }

    foreach ($guards as $guard) {
        if ($this-&gt;auth-&gt;guard($guard)-&gt;check()) {
            return $this-&gt;auth-&gt;shouldUse($guard);
        }
    }

    throw new AuthenticationException(&#39;Unauthenticated.&#39;, $guards);
}
</code></pre>
<p><strong>Illuminate\auth\GuardHelpers.php</strong></p>
<pre><code class="php">public function check()
{
    return ! is_null($this-&gt;user());
}

public function authenticate()
{
    if (! is_null($user = $this-&gt;user())) {
        return $user;
    }

    throw new AuthenticationException;
}
</code></pre>
<p>可以看到：</p>
<ol>
<li>路由参数作为参数传入 <code>handle</code> 方法，然后调用下面的 <code>authenticate</code> 方法；</li>
<li>分两种情况：<ul>
<li>如果路由参数为空，即使用中间件 <code>auth</code> 不带路由参数时，使用默认看守器，然后调用其中的 <code>authenticate</code> 方法，此方法会返回 user 对象，而这个方法是使用 <code>GuardHelpers</code> 这个 <code>trait</code> 实现的。因为只有在正确返回 user 的情况下才能正常返回，否则会抛出错误而终止，这样就达到了检验效果。</li>
<li>如果路由参数非空，即使用中间件 <code>auth:api</code> 时，<code>if</code> 句中首先检验所给看守器是否可用，可用则调用用 <code>shouldUse</code> 设置为 JWTGuard 看守器，并返回结束。如果 <code>if</code> 句中检验所给参数不可用，则统一返回 <code>Unauthenticated</code> ，达到检验效果。</li>
</ul>
</li>
</ol>
<h4 id="jwt-auth-1"><a href="#jwt-auth-1" class="headerlink" title="jwt.auth"></a>jwt.auth</h4><p><strong>Tymon\JWTAuth\Middleware\Authenticate</strong></p>
<pre><code class="php">public function handle($request, Closure $next)
{
    $this-&gt;authenticate($request);

    return $next($request);
}
</code></pre>
<p><strong>Tymon\JWTAuth\Middleware\BaseMiddleware</strong></p>
<pre><code class="php">public function authenticate(Request $request)
{
    $this-&gt;checkForToken($request);

    try {
        if (! $this-&gt;auth-&gt;parseToken()-&gt;authenticate()) {
            throw new UnauthorizedHttpException(&#39;jwt-auth&#39;, &#39;User not found&#39;);
        }
    } catch (JWTException $e) {
        throw new UnauthorizedHttpException(&#39;jwt-auth&#39;, $e-&gt;getMessage(), $e, $e-&gt;getCode());
    }
}
</code></pre>
<p>可以看到，<code>jwt.auth</code> 这个中间件的错误大多是在 <code>JWTException</code> 定义的，返回的错误种类更加丰富。</p>
<h1 id="三、辅助函数和-Facade"><a href="#三、辅助函数和-Facade" class="headerlink" title="三、辅助函数和 Facade"></a>三、辅助函数和 Facade</h1><h2 id="1-辅助函数"><a href="#1-辅助函数" class="headerlink" title="1. 辅助函数"></a>1. 辅助函数</h2><p>辅助函数是 Laravel 提供的一系列函数，可以很方便的做到一些事情，这里要提到的是 <code>auth()</code></p>
<p>使用这个函数报错的，是因为你用的是 Lumen ，而 Lumen 阉割了这个函数，你可以通过安装扩展补齐。</p>
<h3 id="auth"><a href="#auth" class="headerlink" title="auth()"></a>auth()</h3><p><code>auth</code> 函数返回一个 <a href="https://laravel-china.org/docs/laravel/5.6/authentication" target="_blank" rel="noopener">认证</a> 实例。为了方便起见，你可以使用它来替代 <code>Auth</code> Facade：</p>
<pre><code>$user = auth()-&gt;user();
</code></pre><p>如果需要，你可以指定你想要访问的认证实例：</p>
<pre><code>$user = auth(&#39;admin&#39;)-&gt;user();
</code></pre><blockquote>
<p>以上是官方文档对于此辅助函数的解释。</p>
</blockquote>
<p>接下来我要一句话解释上面这个辅助函数，你可以仔细品味这句话直到理解为止：</p>
<blockquote>
<p>auth() 返回的一个看守器实例，如上面的 SessionGuard 和 JWTGuard ，然后你就可以链式调用对于看守器提供的所有方法，此外这个函数的参数可以指定所要返回的看守器实例，否则返回默认的，例如 auth(‘api’)。</p>
</blockquote>
<pre><code class="php">&#39;guards&#39; =&gt; [
    &#39;web&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;session&#39;,    // SessionGuard 实现
        &#39;provider&#39; =&gt; &#39;users&#39;,    
    ],

    &#39;api&#39; =&gt; [
        &#39;driver&#39; =&gt; &#39;jwt&#39;,  // JWTGuard 实现，源码中为 token，我这改成 jwt 了
        &#39;provider&#39; =&gt; &#39;users&#39;,
    ],
]
</code></pre>
<h3 id="JWT-下的-auth"><a href="#JWT-下的-auth" class="headerlink" title="JWT 下的 auth()"></a>JWT 下的 auth()</h3><p>安装 JWT 后，你可以在 auth() 后面调用 factory() 或 payload() 之类的来调用更多定义的方法。（看了源代码没看懂是怎么实现的，可能是 <code>__call</code> 魔术方法），可用的有下面这些：</p>
<h4 id="auth-gt-factory"><a href="#auth-gt-factory" class="headerlink" title="auth()-&gt;factory()"></a>auth()-&gt;factory()</h4><h4 id="auth-gt-blacklist"><a href="#auth-gt-blacklist" class="headerlink" title="auth()-&gt;blacklist()"></a>auth()-&gt;blacklist()</h4><h4 id="auth-gt-manager"><a href="#auth-gt-manager" class="headerlink" title="auth()-&gt;manager()"></a>auth()-&gt;manager()</h4><h4 id="auth-gt-payload"><a href="#auth-gt-payload" class="headerlink" title="auth()-&gt;payload()"></a>auth()-&gt;payload()</h4><p><strong>使用示例：</strong></p>
<pre><code class="php">$exp = auth()-&gt;payload()-&gt;get(&#39;exp&#39;);
$json = auth()-&gt;payload()-&gt;toJson();
$array = auth()-&gt;payload()-&gt;jsonSerialize();
</code></pre>
<p>更多的方法可以去源代码下看。</p>
<h2 id="2-Facade"><a href="#2-Facade" class="headerlink" title="2. Facade"></a>2. Facade</h2><p><strong>config/app.php</strong></p>
<pre><code class="php">&#39;aliases&#39; =&gt; [
    ...
    &#39;JWTAuth&#39; =&gt; &#39;Tymon\JWTAuth\Facades\JWTAuth&#39;,
    &#39;JWTFactory&#39; =&gt; &#39;Tymon\JWTAuth\Facades\JWTFactory&#39;,
],
</code></pre>
<p>Facade 可以为你的编程带来一点便利，具体的使用我在 <a href="/2018/01/11/Laravel-Lumen%E6%95%99%E7%A8%8B4-JWT%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">Laravel/Lumen教程4-JWT的基本使用</a> 一文中有详细介绍，这里展示一个小的使用示例：    </p>
<pre><code class="php">/**
 * Get the guard to be used during authentication.
 * 这个和方法和辅助函数 auth() 差不多，如果 Lumen 不想用插件补充 auth()，可以这么写
 *
 * @return \Illuminate\Contracts\Auth\Guard
 */
public function guard()
{
    return JWTAuth::guard();
}
</code></pre>
<blockquote>
<p>此外 Auth::  这个 Facade 也是返回一个看守器实例，当成辅助函数 auth 使用就好了。</p>
</blockquote>

        
    

    
</div>


                

                <!-- Post Comments -->
                
                    
    <!-- 使用 changyan -->
<div id="changyan-comment">
    <!--PC和WAP自适应版-->
<div id="SOHUCS" sid="2018/05/08/Laravel-辅助函数auth与JWT扩展详解/"  ></div>
<script type="text/javascript">
(function(){
var appid = 'cyt4hOWBJ';
var conf = '80d25ad8e61164f63c15273437d47890';
var width = window.innerWidth || document.documentElement.clientWidth;
if (width < 960) {
window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>

</div>
<style>
    #changyan-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>

                
            </div>

            <!-- Post Prev & Next Nav -->
            <nav class="material-nav mdl-color-text--grey-50 mdl-cell mdl-cell--12-col">
    <!-- Prev Nav -->
    
        <a href="/2018/05/08/Homestead搭建Laravel开发环境/" id="post_nav-newer" class="prev-content">
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_back</i>
            </button>
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            新篇
        </a>
    

    <!-- Section Spacer -->
    <div class="section-spacer"></div>

    <!-- Next Nav -->
    
        <a href="/2018/05/04/投票系统的重构/" id="post_nav-older" class="next-content">
            旧篇
            &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <button class="mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon mdl-color--white mdl-color-text--grey-900" role="presentation">
                <i class="material-icons">arrow_forward</i>
            </button>
        </a>
    
</nav>

        </div>
    </div>



                    
                        <!-- Overlay For Active Sidebar -->
<div class="sidebar-overlay"></div>

<!-- Material sidebar -->
<aside id="sidebar" class="sidebar sidebar-colored sidebar-fixed-left" role="navigation">
    <div id="sidebar-main">
        <!-- Sidebar Header -->
        <div class="sidebar-header header-cover" style="background-image: url(https://ooo.0o0.ooo/2017/06/19/5947a4c3a936a.jpg);">
    <!-- Top bar -->
    <div class="top-bar"></div>

    <!-- Sidebar toggle button -->
    <button type="button" class="sidebar-toggle mdl-button mdl-js-button mdl-js-ripple-effect mdl-button--icon" style="display: initial;" data-upgraded=",MaterialButton,MaterialRipple">
        <i class="material-icons">clear_all</i>
        <span class="mdl-button__ripple-container">
            <span class="mdl-ripple">
            </span>
        </span>
    </button>

    <!-- Sidebar Avatar -->
    <div class="sidebar-image">
        <img src="https://ooo.0o0.ooo/2017/06/19/5947a26ed9af5.jpg" alt="Arony's avatar">
    </div>

    <!-- Sidebar Email -->
    <a data-toggle="dropdown" class="sidebar-brand" href="#settings-dropdown">
        sky.arony@qq.com
        <b class="caret"></b>
    </a>
</div>


        <!-- Sidebar Navigation  -->
        <ul class="nav sidebar-nav">
    <!-- User dropdown  -->
    <li class="dropdown">
        <ul id="settings-dropdown" class="dropdown-menu">
            
                <li>
                    <a href="#" target="_blank" title="Email Me">
                        
                            <i class="material-icons sidebar-material-icons sidebar-indent-left1pc-element">email</i>
                        
                        Email Me
                    </a>
                </li>
            
        </ul>
    </li>

    <!-- Homepage -->
    
        <li id="sidebar-first-li">
            <a href="/">
                
                    <i class="material-icons sidebar-material-icons">home</i>
                
                主页
            </a>
        </li>
        
    

    <!-- Archives  -->
    
        <li class="dropdown">
            <a href="#" class="ripple-effect dropdown-toggle" data-toggle="dropdown">
                
                    <i class="material-icons sidebar-material-icons">inbox</i>
                
                    归档
                <b class="caret"></b>
            </a>
            <ul class="dropdown-menu">
            <li>
                <a class="sidebar_archives-link" href="/archives/2018/05/">五月 2018<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/04/">四月 2018<span class="sidebar_archives-count">5</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/03/">三月 2018<span class="sidebar_archives-count">4</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/02/">二月 2018<span class="sidebar_archives-count">2</span></a></li><li><a class="sidebar_archives-link" href="/archives/2018/01/">一月 2018<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/12/">十二月 2017<span class="sidebar_archives-count">3</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/11/">十一月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/10/">十月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/07/">七月 2017<span class="sidebar_archives-count">1</span></a></li><li><a class="sidebar_archives-link" href="/archives/2017/06/">六月 2017<span class="sidebar_archives-count">1</span></a>
            </ul>
        </li>
        
    

    <!-- Categories  -->
    

    <!-- Pages  -->
    
        <li>
            <a href="/tags" title="标签云">
                
                    <i class="material-icons sidebar-material-icons">label outline</i>
                
                标签云
            </a>
        </li>
        
    
        <li>
            <a href="/gallery" title="相册">
                
                    <i class="material-icons sidebar-material-icons">photo</i>
                
                相册
            </a>
        </li>
        
    
        <li>
            <a href="/timeline" title="时间轴">
                
                    <i class="material-icons sidebar-material-icons">timeline</i>
                
                时间轴
            </a>
        </li>
        
    
        <li>
            <a href="/about" title="关于我">
                
                    <i class="material-icons sidebar-material-icons">person</i>
                
                关于我
            </a>
        </li>
        
    
        <li>
            <a href="/links" title="友情链接">
                
                    <i class="material-icons sidebar-material-icons">link</i>
                
                友情链接
            </a>
        </li>
        
            <li class="divider"></li>
        
    

    <!-- Article Number  -->
    
</ul>


        <!-- Sidebar Footer -->
        <!--
I'm glad you use this theme, the development is no so easy, I hope you can keep the copyright, I will thank you so much.
If you still want to delete the copyrights, could you still retain the first one? Which namely "Theme Material"
It will not impact the appearance and can give developers a lot of support :)

很高兴您使用并喜欢该主题，开发不易 十分谢谢与希望您可以保留一下版权声明。
如果您仍然想删除的话 能否只保留第一项呢？即 "Theme Material"
它不会影响美观并可以给开发者很大的支持和动力。 :)
-->

<!-- Sidebar Divider -->

    <div class="sidebar-divider"></div>


<!-- Theme Material -->

    <a href="https://github.com/viosey/hexo-theme-material"  class="sidebar-footer-text-a" target="_blank">
        <div class="sidebar-text mdl-button mdl-js-button mdl-js-ripple-effect sidebar-footer-text-div" data-upgraded=",MaterialButton,MaterialRipple">
            主题 - Material
            <span class="sidebar-badge badge-circle">i</span>
        </div>
    </a>


<!-- Help & Support -->
<!--

-->

<!-- Feedback -->
<!--

-->

<!-- About Theme -->
<!--

-->

    </div>

    <!-- Sidebar Image -->
    

</aside>

                    

                    
                        <!-- Footer Top Button -->
                        <div id="back-to-top" class="toTop-wrap">
    <a href="#top" class="toTop">
        <i class="material-icons footer_top-i">expand_less</i>
    </a>
</div>

                    

                    <!--Footer-->
<footer class="mdl-mini-footer" id="bottom">
    
        <!-- Paradox Footer Left Section -->
        <div class="mdl-mini-footer--left-section sns-list">
    <!-- Twitter -->
    

    <!-- Facebook -->
    

    <!-- Google + -->
    

    <!-- Weibo -->
    
        <a href="http://weibo.com/2112550135/profile?rightmod=1&amp;wvr=6&amp;mod=personinfo" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-weibo">
                <span class="visuallyhidden">Weibo</span>
            </button><!--
     --></a>
    

    <!-- Instagram -->
    

    <!-- Tumblr -->
    

    <!-- Github -->
    
        <a href="https://github.com/skyArony" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-github">
                <span class="visuallyhidden">Github</span>
            </button><!--
     --></a>
    

    <!-- LinkedIn -->
    

    <!-- Zhihu -->
    

    <!-- Bilibili -->
    
        <a href="http://space.bilibili.com/30387945/#!/" target="_blank">
            <button class="mdl-mini-footer--social-btn social-btn footer-sns-bilibili">
                <span class="visuallyhidden">Bilibili</span>
            </button><!--
     --></a>
    

    <!-- Telegram -->
    
    
    <!-- V2EX -->
    
</div>


        <!--Copyright-->
        <div id="copyright">
            Copyright&nbsp;©&nbsp;2017&nbsp;-<script type="text/javascript">var fd = new Date();document.write("&nbsp;" + fd.getFullYear() + "&nbsp;");</script>Arony's 技术博客
            
        </div>

        <!-- Paradox Footer Right Section -->

        <!--
        I am glad you use this theme, the development is no so easy, I hope you can keep the copyright.
        It will not impact the appearance and can give developers a lot of support :)

        很高兴您使用该主题，开发不易，希望您可以保留一下版权声明。
        它不会影响美观并可以给开发者很大的支持。 :)
        -->

        <div class="mdl-mini-footer--right-section">
            <div>
                <div class="footer-develop-div">Powered by <a href="https://hexo.io" target="_blank" class="footer-develop-a">Hexo</a></div>
                <div class="footer-develop-div">Theme - <a href="https://github.com/viosey/hexo-theme-material" target="_blank" class="footer-develop-a">Material</a></div>
            </div>
        </div>
    
</footer>


                    <!-- Import JS File -->

    <script>lsloader.load("lazyload_js","/js/lazyload.min.js?1BcfzuNXqV+ntF6gq+5X3Q==", true)</script>



    <script>lsloader.load("js_js","/js/js.min.js?V/53wGualMuiPM3xoetD5Q==", true)</script>



    <script>lsloader.load("np_js","/js/nprogress.js?pl3Qhb9lvqR1FlyLUna1Yw==", true)</script>


<script type="text/ls-javascript" id="NProgress-script">
    NProgress.configure({
        showSpinner: true
    });
    NProgress.start();
    $('#nprogress .bar').css({
        'background': '#29d'
    });
    $('#nprogress .peg').css({
        'box-shadow': '0 0 10px #29d, 0 0 15px #29d'
    });
    $('#nprogress .spinner-icon').css({
        'border-top-color': '#29d',
        'border-left-color': '#29d'
    });
    setTimeout(function() {
        NProgress.done();
        $('.fade').removeClass('out');
    }, 800);
</script>





    <!-- Leancloud -->
    <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
    <script>
        AV.initialize('MA3ePB77pgSwRAhI6NTRHcd5-gzGzoHsz', '5tEL3rl9PsLi9hrcoVky3VYp');
    </script>
    <script type="text/ls-javascript" id="leancloud-views-script">
    function showTime(Counter) {
        var query = new AV.Query(Counter);
        $('.leancloud-views_num').each(function() {
            var url = $(this).attr('id').trim();
            query.equalTo('url', url);
            query.find({
                success: function(results) {
                    if (results.length === 0) {
                        var content = '0 ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                        return;
                    }
                    for (var i = 0; i < results.length; i++) {
                        var object = results[i];
                        var content = object.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    }
                },
                error: function(object, error) {
                    console.log('Error: ' + error.code + ' ' + error.message);
                }
            });
        });
    }

    function addCount(Counter) {
      var Counter = AV.Object.extend('Counter');
      url = $('.leancloud-views_num').attr('id').trim();
      title = $('.leancloud-views_num').attr('data-flag-title').trim();
      var query = new AV.Query(Counter);
      query.equalTo('url', url);
      query.find({
          success: function(results) {
            if (results.length > 0) {
                var counter = results[0];
                counter.fetchWhenSave(true);
                counter.increment('time');
                counter.save(null, {
                    success: function(counter) {
                        var content =  counter.get('time') + ' ' + $(document.getElementById(url)).text();
                        $(document.getElementById(url)).text(content);
                    },
                    error: function(counter, error) {
                        console.log('Failed to save Visitor num, with error message: ' + error.message);
                    }
                });
            } else {
              var newcounter = new Counter();
              newcounter.set('title', title);
              newcounter.set('url', url);
              newcounter.set('time', 1);
              newcounter.save(null, {
                  success: function(newcounter) {
                      console.log('newcounter.get(\'time\')='+newcounter.get('time'));
                      var content = newcounter.get('time') + ' ' + $(document.getElementById(url)).text();
                      $(document.getElementById(url)).text(content);
                  },
                  error: function(newcounter, error) {
                      console.log('Failed to create');
                  }
              });
            }
        },
        error: function(error) {
            console.log('Error:' + error.code + ' ' + error.message);
        }
      });
    }
    $(function() {
        var Counter = AV.Object.extend('Counter');
        if ($('.leancloud-views_num').length === 1) {
            addCount(Counter);
        } else if ($('.post-title-link').length > 1) {
            showTime(Counter);
        }
    });
</script>






   <!-- 畅言公共 js 代码 start -->
<script id="cy_cmt_num" src="https://changyan.sohu.com/upload/plugins/plugins.list.count.js?clientId=cyt4hOWBJ">
</script>
<!-- 畅言公共 js 代码 end -->





<!-- UC Browser Compatible -->
<script>
	var agent = navigator.userAgent.toLowerCase();
	if(agent.indexOf('ucbrowser')>0) {
		document.write('<link rel="stylesheet" href="/css/uc.css">');
	   alert('由于 UC 浏览器使用极旧的内核，而本网站使用了一些新的特性。\n为了您能更好的浏览，推荐使用 Chrome 或 Firefox 浏览器。');
	}
</script>

<!-- Import prettify js  -->

    
        
            <script>lsloader.load("prettify_js","/js/prettify.min.js?WN07fivHQSMKWy7BmHBB6w==", true)</script>
        
    



<!-- Window Load -->
<!-- add class for prettify -->
<script type="text/ls-javascript" id="window-load">
    $(window).on('load', function() {
        // Post_Toc parent position fixed
        $('.post-toc-wrap').parent('.mdl-menu__container').css('position', 'fixed');
    });

    
        
            $(function() {
                $('pre').addClass('prettyprint linenums').attr('style', 'overflow:auto;');
                prettyPrint();
                })
        
    
    
</script>

<!-- MathJax Load-->


<!-- Bing Background -->


<script type="text/ls-javascript" id="lazy-load">
    // Offer LazyLoad
    queue.offer(function(){
        $('.lazy').lazyload({
            effect : 'show'
        });
    });

    // Start Queue
    $(document).ready(function(){
        setInterval(function(){
            queue.execNext();
        },200);
    });
</script>

<!-- Custom Footer -->



<script>
    (function(){
        var scriptList = document.querySelectorAll('script[type="text/ls-javascript"]')

        for (var i = 0; i < scriptList.length; ++i) {
            var item = scriptList[i];
            lsloader.runInlineScript(item.id,item.id);
        }
    })()
console.log('\n %c © Material Theme | Version: 1.5.2 | https://github.com/viosey/hexo-theme-material %c \n', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-left-radius:5px;border-bottom-left-radius:5px;', 'color:#455a64;background:#e0e0e0;padding:5px 0;border-top-right-radius:5px;border-bottom-right-radius:5px;');
</script>

                </main>
            </div>
        </body>
    
</html>
